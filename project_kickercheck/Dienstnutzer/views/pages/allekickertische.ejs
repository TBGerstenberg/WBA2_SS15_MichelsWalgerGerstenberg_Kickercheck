<!DOCTYPE html>
<html>
    <head>
        <% include ../partials/head %>
    </head>


    <body class="container">
        <header>
            <% include ../partials/header %>
        </header>
        <main>
            <div class="row">
                <div class="col-sm-12">

                    <div class="jumbotron">
                        <h2>Liste aller Kickertische von <a href="/Austragungsort/<%= austragungsort.id %>"><%= austragungsort.Name %></a></h2>

                        <br />

                        <div class="list-group">
                            
                            <script>
                            $(document).ready(function() {
                                
                $('#forderungForm').submit(function(e) {
                    e.preventDefault();
                    

                    var kickertisch = $('#zustand').val();


                    if(!(zustand)) {
                        alert('Bitte Daten spezifizieren.');
                        return false;
                    }

                    var formData = {Zustand: zustand
                                   };


                    $.ajax({
                        type: 'PUT',
                        url:  '/Kickertisch/<%= kickertisch.id %>/Forderung',
                        contentType: 'application/json',
                        data: JSON.stringify(formData),
                        success: function(data) {

                            $('#changeData').each(function() {
                                this.reset();
                            });

                            alert('Zustand erfolgreich ge√§ndert.');

                            $("#zus").text('Zustand: '+data.Zustand);


                        },
                        fail: function() {
                            alert('Fehler');
                        }

                    });
                });
                                
                            });
                            </script>
                            
                              <% kickertische.forEach(function(kickertisch) {  %>

                            <a href="Kickertisch/<%= kickertisch.id %>/" class="list-group-item"> <h4 class="list-group-item-heading"><%= kickertisch.Typ %></h4>
                                <p class="list-group-item-text">Hersteller: <%= kickertisch.Hersteller %></p>
                                <p class="list-group-item-text">Zustand: <%= kickertisch.Zustand %></p>
                                <% belegungen.forEach(function(belegung) {  %>
                                <% if(belegung.id == kickertisch.id) { %>
                                <p class="list-group-item-text">Belegung: <%= belegung.Anzahl %> Spieler</p>
                                <% if(belegung.id == kickertisch.id) { %>
                                <% if(belegung.Anzahl > 0) { %>
                                <p class="list-group-item-text">Teilnehmer: <%= belegung.Teilnehmer %></p>
                                <% } %>
                                 <p class="list-group-item-text">Forderungen: <%= belegung.Forderungen %></p>
                                <%  } } }); %>
                                 <form role="form" action="" method="PUT" name="forderungForm" id="forderungForm">
                            <input type="submit" id="forderung" class="btn btn-success" name="forderung" value="Diesen Tisch fordern" />
                        </form>
                
                            </a>

                            <%  }); %>
                        </div>

                    </div>

                </div>

            </div>
        </main>

        <footer>
            <% include ../partials/footer %>
        </footer>

    </body>
</html>