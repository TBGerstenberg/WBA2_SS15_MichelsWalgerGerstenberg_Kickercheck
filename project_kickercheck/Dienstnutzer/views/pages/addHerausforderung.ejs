<!DOCTYPE html>
<html>
    <head>
        <% include ../partials/head %>
        <script type="text/javascript">
            $(document).ready(function(){

                $('.addid').html('');
                var d = new Date();
                var time = d.setDate(d.getDate()-1);
                
                var url = window.location.pathname.split("/");
                var pathurl = url[2];

                $('.datepick').datetimepicker({format:'DD.MM.YYYY', minDate: time});
                $('.timepick').datetimepicker({format:'HH:mm'});
                
                
                $('#HerausforderungAnlegen').submit(function(){
                    
                    var teilnehmer ="Benutzer"+pathurl;
                    var teilnehmer2 = $('#user1').val();
                    var datum = $('#datum').val();
                    var text = $('#HerausforderungsText').val();
                    var austragungsort = $('#ado').val();
                    
                    var formData = {
                        
                        Datum : datum,
                        Herausgeforderter: teilnehmer1,
                        Herausforderer: teilnehmer2,
                        Austragungsort: austragungsort,
                        Kurztext: text,
                        
                    }
                    
                    var uri = "/Benutzer/"+pathurl+"/Herausforderung";
                    
                    $.ajax(uri,{
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(formData),
                        success: function(data){
                        },
                        statusCode:{
                        
                        },
                        fail:function(){
                            
                        }
                    });
                    alert("Die Herausforderung wurde verschickt");
            });
        });
        </script>
    </head>

    <body class="container">
        <header>
            <% include ../partials/header %>
        </header>
        <main>
            <div class="row">
                <div class="col-sm-12">

                    <div class="jumbotron">
                     
                        <h1>Add Herausforderung</h1>

                                <div class="row">
                            <div class="col-md-6">
                                <form role="form" action="" name="HerausforderungAnlegen" id="HerausforderungAnlegen">

                                    <div class="form-group">
                                        <label for="teilnehmer">Benutzer der fordert:</label> <br>

                                        <select id="user1" class="form-control">
                                            <option value="0">Bitte wählen</option>
                                            <% benutzerAll.forEach(function(benutzer) { %>
                                            <option class="teilnehmer1" value="/Benutzer/<%= benutzer.id %>"><%= benutzer.Name %></option>
                                            <% });  %>
                                        </select>
                                    </div>
                                    
                                     <div class="form-group">
                                        <label for="austragungsort">Austragungsort:</label> <br>
                                         <select id="ato" class="form-control">
                                            <option value="0">Bitte wählen</option>
                                            <% austragungsorte.forEach(function(austragungsort) { %>
                                            <option class="austragungsort" value="/Austragungsort/<%= austragungsort.id %>">
                                        <%= austragungsort.Name %> 
                                                <% ortTischMapping.forEach(function(map) { 
                                                if(map.Ort == austragungsort.Name) { %> 
                                                (<%= map.Tische %> Kickertische)
                                                <%} }); %>
                                             </option>
                                            <% }); %>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="datum">Datum:</label> <br>
                                        <div class="row">
                                            <div class='col-sm-12'>
                                                <input type='text' id="datum" placeholder="Datum" class="form-control datepick" />
                                            </div>
                                        </div>
                                        
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="name">Herausforderungs Text:</label> <br>
                                        <input type="text" id="HerausforderungsText" class="form-control" placeholder="Name" maxlength="100" />
                                    </div>

                                    <input type="submit" class="btn btn-primary" name="send" value="Absenden" />

                                </form>
                            </div>
                        </div>
                        <br />
                        <p class="addid"></p>
                    </div>

                </div>

            </div>
        </main>

        <footer>
            <% include ../partials/footer %>
        </footer>

    </body>
</html>