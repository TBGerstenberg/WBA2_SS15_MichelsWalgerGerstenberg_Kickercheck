<!DOCTYPE html>
<html>
    <head>
        <% include ../partials/head %>
    </head>
    <script>
        
        $(document).ready( function(event){

            
           $('.deleteHerausforderung').click( function(){
                var button = $(this);
               var herausforderungId = button.attr('data-herausforderungsID');
               
               deleteHerausforderung(herausforderungId);
               var urlBenutzer = window.location.pathname.split("/");
               var benutzerId = urlBenutzer[2];
                alert("Herausforderung abgelehnt");
               location.href="/Benutzer/"+benutzerId+"/alleHerausforderungen"
        });
            
        
            $('.acceptHerausforderung').click( function(){
                var button = $(this);
                alert("Sie haben die Herausforderung Akzeptiert! Legen sie jetzt ein Match an!");
                location.href="/Match/addMatch"     
            });
            
            
        });


     function deleteHerausforderung(herausforderungId){
         
          var url = window.location.pathname.split("/");
    
            var pathurl = url[2];
        
          $.ajax({
                        type: 'DELETE',
                        url: '/Benutzer/'+pathurl+"/Herausforderung/"+herausforderungId,
                        contentType: 'application/json',
                        success: function(data) {
                        
                        },
                        fail: function() {
                            alert('Fehler');
                        }
                    });
        }
    
    </script>

    <body class="container">
        <header>
            <% include ../partials/header %>
        </header>

        <main>
            <div class="row">
                <div class="col-sm-12">

                    <div class="jumbotron">
                        <h2>Liste aller Herausforderungen</h2>
                        <br />

                        <div class="list-group">
                        
                            <% response.forEach(function(Herausforderung) { %>
                            <a href="./Herausforderung/<%= Herausforderung.id %>" class="list-group-item"><h4 class="list-group-item-heading">Herausforderung <%= Herausforderung.id %></h4>
                                
                                <p class="list-group-item-text">Herausgeforderter:  <% benutzerAll.forEach(function(benutzer) { %>
                                <% if("/Benutzer/"+benutzer.id == Herausforderung.Herausgeforderter) { %><%= benutzer.Name %><% } }); %></p>
                                <p class="list-group-item-text">Herausforderer: 
                                 <% benutzerAll.forEach(function(benutzer) { %>
                                <% if("/Benutzer/"+benutzer.id == Herausforderung.Herausforderer) { %><%= benutzer.Name %><% } }); %></p>
                                <p class="list-group-item-text">Datum: <%= Herausforderung.Datum %></p>
                                <p class="list-group-item-text">Austragungsort: <% austragungsorte.forEach(function(ort) { %>
                                <% if("/Austragungsort/"+ort.id == Herausforderung.Austragungsort) { %><%= ort.Name %><% } }); %></p>
                                <p class="list-group-item-text">Text: <%= Herausforderung.Kurztext %></p>

                            </a>
                            <button class="btn btn-danger deleteHerausforderung" data-herausforderungsID="<%= Herausforderung.id %>"> Ablehnen </button>
                            <button class="btn btn-success acceptHerausforderung" data-herausforderungsID="<%= Herausforderung.id %>" data-herausforderungHerausforderer="<%= Herausforderung.Herausforderer %>" data-herausforderungDatum="<%= Herausforderung.Datum %>" > Annehmen </button>
                            <% });  %>
                        </div>

                    </div>

                </div>

            </div>
        </main>

        <footer>
            <% include ../partials/footer %>
        </footer>

    </body>
</html>