<!DOCTYPE html>
<html>
<head>
    <% include ../partials/head %>
</head>
<script>
$(document).ready(function() {
	
		 var d = new Date();
				var time = d.setDate(d.getDate()-1);
				
				 var ortURI = "<%= match.Austragungsort %>".split("/");
				 var ort = "/"+ortURI[1]+"/"+ortURI[2];
				 $('#tis').append('<a href="'+ort+'"><%= austragungsort.Name %></a>');
				 
				 if(!ortURI[3]) {
					 $('#aort').html('');
				 }
	 
			
			   $('.datepick').datetimepicker({format:'DD.MM.YYYY', minDate: time});
			    $('.timepick').datetimepicker({format:'HH:mm'});
			    
			        $('#addTisch').submit(function(e) {
							e.preventDefault();
							
							var tisch = $('#kit').val();
							var datum = $('#dat').text();
							var uhrzeit = $('#uhr').text();
							
							

			 var formData = {Datum: datum,
				 Uhrzeit: uhrzeit,
				 Austragungsort: tisch
			 };
		

							$.ajax({
								type: 'PUT',
								url: '/Match/<%= match.id %>',
								contentType: 'application/json',
								data: JSON.stringify(formData),
								success: function(data) {
						alert('Tisch wurde erfolgreich gesetzt.');
						window.location.reload(true);
						
								},
        fail: function() {
	        alert('Fehler');
        }
			
						});
						});
			    
			    $('#startMatch').submit(function(e) {
							e.preventDefault();

			 var formData = {Status: 'aktiv'};


							$.ajax({
								type: 'PUT',
								url: '/Match/<%= match.id %>',
								contentType: 'application/json',
								data: JSON.stringify(formData),
								success: function(data) {
						
						window.location.reload(true);
						
								},
        fail: function() {
	        alert('Fehler');
        }
			
						});
						});
	
	$('#changeData').submit(function(e) {
							e.preventDefault();
			
				 var datum = $('#datum').val();
				 var uhrzeit = $('#uhrzeit').val();
					var tisch = $('#aort').text();
					
					console.log(tisch);

							if(!(datum && uhrzeit)) {
								alert('Bitte Daten spezifizieren.');
								return false;
								}
			 
			 var formData = {Datum: datum,
				 Uhrzeit: uhrzeit,
				  Austragungsort: tisch
			 };


							$.ajax({
								type: 'PUT',
								url: '/Match/<%= match.id %>',
								contentType: 'application/json',
								data: JSON.stringify(formData),
								success: function(data) {
									
									 $('#changeData').each(function() {
                        this.reset();
                   });
                   
                   

							  $("#dat").text(data.Datum);
							  $("#uhr").text(data.Uhrzeit);
								
								},
        fail: function() {
	        alert('Fehler');
        }
			
						});
						});
});
</script>
<body class="container">
  <header>
        <% include ../partials/header %>
    </header>
 <main>
        <div class="row">
            <div class="col-sm-8">
            
            
                <div class="jumbotron">
                    <h1>Match <%= match.id %></h1>
                   <br />
                  
                     <ul>
            <li>Datum: <span id="dat"><%= match.Datum %></span></li>
              <li> Startzeitpunkt: <span id="uhr"><%= match.Uhrzeit %></span> Uhr</li>
               <li> Austragungsort:  <span id="tis"></span></li>
                <span id="aort"><li><a href="<%= match.Austragungsort %>">Gewählter Kickertisch</a></span></li></span>
              <li id="stat"> Status: <%= match.Status %></li>
                    </ul> 
                    <br />
                 
                    <div id="teiln">
                    <p>Liste der Teilnehmer: </p>
                   
                    <ul>
                    <% if (match.Teilnehmer) { %>
                      <% for(var i=0; i < match.Teilnehmer.length; i++) { %>
                    <li><%= match.Teilnehmer[i] %></li>
                    <% }}; %>
                    </ul>
                    </div>
                    <hr />

                     <form role="form" action="" method="POST" name="addTisch" id="addTisch">
                        <div class="form-group">
         <label for="kickertisch">Kickertisch:</label> <br>
         <select id="kit" class="form-control">
	     <option value="0">Bitte wählen</option>
           <% kickertische.forEach(function(tisch) { %>
         <option class="kickertisch" value="/Austragungsort/<%= austragungsort.id %>/Kickertisch/<%= tisch.id %>/">Hersteller: <%= tisch.Hersteller  %>, Typ: <%= tisch.Typ  %></option>
         <% });  %>
         </select>
         </div>
           <input type="submit" class="btn btn-primary" name="change" value="Kickertisch übernehmen" />
         </form>
         
             <hr />
           

                    <div id="divdata" class="margintop20">
                    <p> Match ändern: </p>
                    <form role="form" action="" method="POST" name="changeData" id="changeData">
                      <div class="form-group">
		 <label for="datum">Datum:</label> <br>
		 <div class="row">
		  <div class='col-sm-12'>
                    <input type='text' id="datum" placeholder="Datum" class="form-control datepick" />
                      </div>
                      </div>
                       <label for="uhrzeit">Uhrzeit:</label> <br>
                      <div class="row">
		  <div class='col-sm-12'>
                    <input type='text' id="uhrzeit" placeholder="Uhrzeit" class="form-control timepick" />
                      </div>
                      </div>
                      
                                           
                      </div>
                         
           <input type="submit" class="btn btn-primary" name="change" value="Ändern" />
           </form>
           </div>
           <hr />
        
                     <div id="divstart" class="margintop20">
                    <form role="form" action="" method="PUT" name="startMatch" id="startMatch">
 <input type="submit" class="btn btn-success" name="start" value="Match starten" />
 </form>
                    </div>
                    <hr />
           
<br />
<h4>Regeln</h4>
<br />

<%= match.Regelwerk %>
  	       
                </div>
                
            </div>
           
        </div>
    </main>
 <footer>
        <% include ../partials/footer %>
    </footer>
    
</body>
</html>